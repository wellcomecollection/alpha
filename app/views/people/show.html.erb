<% content_for :title, @person.name %>
<div class="row">
  <div class="two columns center" style="padding:10px;">

    <% if @person.wikipedia_image %>
      <div class="person-portrait" style='background-image: url("<%= @person.wikipedia_image(150) %>");'></div>
    <% else %>
      <div class="person-portrait">&nbsp;</div>
    <% end %>

  </div>
  <div class="ten columns big">
    <h1><%= @person.name %></h1>

    <p>
      <% if @person.born_in || @person.died_in %>
        <span class="dates"><%= @person.born_in %>-<%= @person.died_in %></span><br />
      <% end %>

      <% if @person.wikipedia_intro && @person.wikipedia_intro.length > 0 %>
          <% @person.wikipedia_intro[0..1].each do |s| %>
            <%= s.gsub(/\[\d+\]/, '').gsub(/\s?\([^\)]+\)/, '') %>
          <% end %>
      <% end %>

      <% if @person.identifiers['wikipedia_en'] %>
        <small><%= link_to "Wikipedia", "https://en.wikipedia.org/wiki/#{@person.identifiers['wikipedia_en']}" %></small>
      <% end %>

      <% if @person.identifiers['loc'].nil? %>
        <span class="nogo">There was no LC ID for this author in the database, so we couldn't connect to Wikipedia.</span>
      <% end %>
    </p>
</div>
<div class="row">
	<div class="eight columns">
    <h4>Subjects</h4>

      <% if @top_subjects_written_about.length > 0 %>
		<p>
		<% @top_subjects_written_about.each do |subject| %>
        		<%= link_to subject.label, subject_path(subject) %>
      		<% end %>
      	</p>
      <% else %>
	<p class="nogo">We couldn't find any!</p>
      <% end %>
	</div>
	<div class="four columns" style="background-color: white; padding: 20px;">

    <% if @person.editorial %>
		  <h4><%= @person.editorial_title %></h4>
		  <%= @person.editorial_content.html_safe %>
    <% end %>

    <% if logged_in_as_admin? %>
      <%= link_to (@person.editorial ? 'Edit' : 'Add editorial'), person_editorial_path(@person) %>
    <% end %>
	</div>
</div>
<div class="row">
	<div class="twelve columns">
	<h4>Timeline</h4>

	<% years = {} %>

	  <% @publication_years.each do |year| %>
		<% years[year[0].gsub(' ', '?')] = pluralize(year[1], '') %>
	  <% end %>

	  <% if @person.born_in %>
		<% years[@person.born_in.to_s] = "born" %>
	  <% end %>

	  <% if @person.died_in %>
		<% years[@person.died_in.to_s] = "died" %>
	  <% end %>


	  <% years.sort_by {|k,v| k}.each do |year| %>
		<div class="year-container center" style="width:40px; float:left;">
		  <div class="year"><small><%= year[0] %></small></div>
		  <div class="thing"><small><%= year[1] %></small></div>
		</div>
	  <% end %>

  </div>
</div>

<!-- Crick -->
<% if @person.id == 20649 %>
  <%= render 'p20649.html' %>
<% end %>

<!-- Gillray -->
<% if @person.id == 27577 %>
  <%= render 'p27577.html' %>
<% end %>

<br clear="all" />

<div class="row">
  <div class="six columns"><h2><%= pluralize(@person.records_count, 'thing') %></h2></div>
  <div class="three columns right lil-vis">
    <small>
      <%= percentage_with_varying_accuracy(@digitized_count.to_f / @person.records_count) %>  digitised
    </small>
  </div>
  <div class="three columns lil-vis">
		<div class="digitised">
			<div class="percent-done" style="width: <%= (100 * @digitized_count.to_f / @person.records_count) %>%;">&nbsp;</div>
		</div>
  </div>
</div>

<% @things.each do |thing| %>
  <div class="cover-box">
    <div class="cover">
      <%= link_to thing_path(thing) do %>
        <% if thing.cover_image_url %>
          <%= image_tag thing.cover_image_url(150,300) %>
        <% else %>
          <%= thing.title %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<br clear="all" />
<br clear="all" />

<% if @co_authors.length > 0 %>
  <h3>Co-authors</h3>
  <% @co_authors.each do |author| %>
	  <div class="sm-circle">
	    <% if author.wikipedia_image %>
	      <% style = "background-image: url('#{author.wikipedia_image}');" %>
	    <% end %>
	    <%= link_to author.name, author, class: 'sm-bg-link', style: style, title: pluralize(author.records_count, 'thing') %>
	    <%= link_to author.name, author, class: 'sm-name', title: pluralize(author.records_count, 'thing') %>
	  </div>
  <% end %>
<% end %>

<br clear="all" />
<br clear="all" />

<% if @contemporaries && @contemporaries.length > 0 %>
  <h3>Contemporaries</h3>
    <% @contemporaries.each do |author| %>
  <div class="sm-circle">
    <% if author.wikipedia_image %>
      <% style = "background-image: url('#{author.wikipedia_image}');" %>
    <% end %>
    <%= link_to author.name, author, class: 'sm-bg-link', style: style, title: pluralize(author.records_count, 'thing') %>
    <%= link_to author.name, author, class: 'sm-name', title: pluralize(author.records_count, 'thing') %>
  </div>
    <% end %>

<% end %>

<br clear="all" />
<br clear="all" />

<div class="row nerds" style="clear: both;">
  <div class="three columns">
    <h5>Data & IDs</h5>
    <p>We've collected identifiers for <%= @person.name %> from other catalogues around the world.</p>
  </div>
  <div class="nine columns">
	<table width="100%">
	  <% @person.identifiers.each_pair do |key, value| %>
	    <tr>
	      <td><%= key %></td>
	      <td><%= value %></td>
	  <% end %>
	</table>
	</div>
</div>

<%= link_to "JSON view", person_path(@person, format: :json) %>